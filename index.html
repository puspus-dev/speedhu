<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>SpeedHU - Sebességmérés</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #000;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    background-color: #111;
    border-radius: 50%;
  }
  #info {
    position: absolute;
    top: 10%;
    text-align: center;
    font-size: 1.5em;
  }
  #startBtn {
    margin-top: 1em;
    padding: 0.5em 2em;
    font-size: 1em;
    cursor: pointer;
    border: none;
    border-radius: 10px;
    background: #222;
    color: #fff;
    transition: background 0.3s;
  }
  #startBtn:hover { background: #444; }
</style>
</head>
<body>
<div id="info">
  <div>Ping: <span id="ping">0</span> ms</div>
  <div>Jitter: <span id="jitter">0</span> ms</div>
  <div>Letöltés: <span id="download">0.0</span> Mbps</div>
  <div>Feltöltés: <span id="upload">0.0</span> Mbps</div>
  <button id="startBtn">Teszt!</button>
</div>
<canvas id="speedCanvas" width="300" height="300"></canvas>
<script>
const canvas = document.getElementById('speedCanvas');
const ctx = canvas.getContext('2d');
const radius = canvas.width / 2 - 20;

let downloadMbps = 0;
let uploadMbps = 0;
let pingMs = 0;
let jitterMs = 0;
let animating = false;

const info = {
  ping: document.getElementById('ping'),
  jitter: document.getElementById('jitter'),
  download: document.getElementById('download'),
  upload: document.getElementById('upload')
};

function drawCircle(progressD=0, progressU=0) {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // háttér kör
  ctx.beginPath();
  ctx.arc(canvas.width/2, canvas.height/2, radius, 0, 2*Math.PI);
  ctx.fillStyle = '#111';
  ctx.fill();

  // letöltés sáv (sárga)
  ctx.beginPath();
  ctx.arc(canvas.width/2, canvas.height/2, radius, -Math.PI/2, -Math.PI/2 + 2*Math.PI*progressD/100);
  ctx.strokeStyle = '#FFD700';
  ctx.lineWidth = 15;
  ctx.stroke();

  // feltöltés sáv (lila)
  ctx.beginPath();
  ctx.arc(canvas.width/2, canvas.height/2, radius-20, -Math.PI/2, -Math.PI/2 + 2*Math.PI*progressU/100);
  ctx.strokeStyle = '#9400D3';
  ctx.lineWidth = 15;
  ctx.stroke();

  // középen szöveg
  ctx.fillStyle = '#fff';
  ctx.font = '24px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('SpeedHU', canvas.width/2, canvas.height/2);
}

// egyszerű animáció
function animateCircle(targetD, targetU) {
  const step = 1;
  function stepAnim() {
    if (!animating) return;
    if (downloadMbps < targetD) downloadMbps += step;
    if (downloadMbps > targetD) downloadMbps -= step;
    if (uploadMbps < targetU) uploadMbps += step;
    if (uploadMbps > targetU) uploadMbps -= step;
    drawCircle(downloadMbps, uploadMbps);
    if (downloadMbps !== targetD || uploadMbps !== targetU) {
      requestAnimationFrame(stepAnim);
    }
  }
  stepAnim();
}

// mérés funkció
async function runTest() {
  animating = true;
  info.download.textContent = '0.0';
  info.upload.textContent = '0.0';
  info.ping.textContent = '0';
  info.jitter.textContent = '0';
  drawCircle(0,0);

  const corsPrefix = 'https://corsproxy.io/?';
  const downloadFile = 'https://speed.hetzner.de/100MB.bin'; // nyilvános fájl
  const uploadFile = 'https://httpbin.org/post'; // POST echo endpoint

  // Ping
  const pingTimes = [];
  for(let i=0;i<5;i++){
    const start = performance.now();
    await fetch(corsPrefix + downloadFile, {method:'HEAD'});
    const delta = performance.now()-start;
    pingTimes.push(delta);
  }
  pingMs = Math.round(pingTimes.reduce((a,b)=>a+b)/pingTimes.length);
  jitterMs = Math.round(Math.sqrt(pingTimes.map(t=>Math.pow(t-pingMs,2)).reduce((a,b)=>a+b)/pingTimes.length));
  info.ping.textContent = pingMs;
  info.jitter.textContent = jitterMs;

  // Download mérés
  const dlStart = performance.now();
  const dlResponse = await fetch(corsPrefix + downloadFile);
  const dlBlob = await dlResponse.blob();
  const dlEnd = performance.now();
  const dlSize = dlBlob.size*8/1024/1024; // Mbps
  const dlTime = (dlEnd-dlStart)/1000;
  const dlSpeed = dlSize/dlTime;
  info.download.textContent = dlSpeed.toFixed(1);
  animateCircle(dlSpeed, 0);

  // Upload mérés (simulált, kisebb adat)
  const uploadData = new Uint8Array(10*1024*1024); // 10MB
  const ulStart = performance.now();
  const ulResponse = await fetch(corsPrefix + uploadFile, {method:'POST', body:uploadData});
  const ulEnd = performance.now();
  const ulSpeed = uploadData.length*8/1024/1024/((ulEnd-ulStart)/1000);
  info.upload.textContent = ulSpeed.toFixed(1);
  animateCircle(dlSpeed, ulSpeed);

  animating = false;
}

// start gomb
document.getElementById('startBtn').addEventListener('click', runTest);

drawCircle();
</script>
</body>
</html>
