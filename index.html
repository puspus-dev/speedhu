<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpeedHU</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background: #f9f9f9;
  text-align: center;
  padding: 40px 20px;
  color: #333;
}

h1 { margin-bottom: 30px; }

#testBtn {
  padding: 15px 50px;
  font-size: 22px;
  border: none;
  border-radius: 25px;
  background: #4CAF50;
  color: white;
  cursor: pointer;
  margin-bottom: 40px;
  transition: 0.3s;
}
#testBtn:hover { background: #45a049; }

.barContainer {
  width: 80%;
  height: 35px;
  background: #e0e0e0;
  border-radius: 25px;
  margin: 20px auto;
  position: relative;
  overflow: hidden;
}

.bar {
  height: 100%;
  width: 0;
  border-radius: 25px;
  position: relative;
}

.bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: -50%;
  width: 50%;
  height: 100%;
  background: rgba(255,255,255,0.3);
  transform: skewX(-20deg);
  animation: shine 1s linear infinite;
}

@keyframes shine {
  0% { left: -50%; }
  100% { left: 100%; }
}

.downloadBar { background: linear-gradient(90deg, #81C784, #4CAF50); }
.uploadBar { background: linear-gradient(90deg, #64B5F6, #2196F3); }
.pingBar { background: linear-gradient(90deg, #FFC107, #FF9800); }

.barLabel {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  font-weight: bold;
  color: #fff;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}

#result { margin-top: 30px; font-size: 18px; }

@media (max-width: 500px){
  #testBtn { width: 100%; font-size: 20px; }
  .barContainer { width: 95%; }
}
</style>
</head>
<body>

<h1>SpeedHU - Internet sebességmérő</h1>
<button id="testBtn">Teszt!</button>

<h3>Ping</h3>
<div class="barContainer"><div id="pingBar" class="bar pingBar"><span class="barLabel" id="pingLabel">0 ms</span></div></div>

<h3>Letöltés</h3>
<div class="barContainer"><div id="downloadBar" class="bar downloadBar"><span class="barLabel" id="downloadLabel">0 Mbps</span></div></div>

<h3>Feltöltés</h3>
<div class="barContainer"><div id="uploadBar" class="bar uploadBar"><span class="barLabel" id="uploadLabel">0 Mbps</span></div></div>

<p id="result"></p>

<script>
// Ping mérés
async function measurePing() {
  const start = performance.now();
  try { await fetch("https://jsonplaceholder.typicode.com/posts/1", {cache:"no-store"}); } catch(e){}
  const end = performance.now();
  return Math.round(end - start);
}

// Letöltés
async function measureDownload() {
  const url = "https://upload.wikimedia.org/wikipedia/commons/3/3f/Fronalpstock_big.jpg";
  const start = performance.now();
  const response = await fetch(url, { cache: "no-store" });
  const blob = await response.blob();
  const end = performance.now();
  const duration = (end - start)/1000;
  const bits = blob.size*8;
  return (bits/duration/1024/1024).toFixed(2);
}

// Feltöltés (64 KB)
async function measureUpload() {
  const data = new Uint8Array(64 * 1024);
  const start = performance.now();
  try { await fetch("https://jsonplaceholder.typicode.com/posts",{method:"POST",body:data}); } catch(e){}
  const end = performance.now();
  const duration = (end - start)/1000;
  const bits = data.length*8;
  return (bits/duration/1024/1024).toFixed(2);
}

// Valós idejű animáció
function animateBar(bar, label, targetValue, unit, duration=1000) {
  let width = 0;
  let value = 0;
  const stepTime = 20;
  const stepWidth = (targetValue * stepTime) / duration;
  const interval = setInterval(() => {
    width += stepWidth;
    value += stepWidth;
    if(width >= targetValue) { width = targetValue; value = targetValue; clearInterval(interval); }
    bar.style.width = width + "%";
    label.textContent = Math.round(value) + " " + unit;
  }, stepTime);
  return new Promise(resolve => setTimeout(resolve, duration));
}

// Fő teszt függvény
async function runTest() {
  const pingBar = document.getElementById("pingBar");
  const downloadBar = document.getElementById("downloadBar");
  const uploadBar = document.getElementById("uploadBar");
  const pingLabel = document.getElementById("pingLabel");
  const downloadLabel = document.getElementById("downloadLabel");
  const uploadLabel = document.getElementById("uploadLabel");
  const result = document.getElementById("result");

  [pingBar, downloadBar, uploadBar].forEach(bar => bar.style.width="0%");
  [pingLabel, downloadLabel, uploadLabel].forEach(label => label.textContent="0");

  result.textContent = "Mérés folyamatban...";

  const ping = await measurePing();
  await animateBar(pingBar, ping*1.5, pingLabel, "ms", 800);

  const download = await measureDownload();
  await animateBar(downloadBar, download*5, downloadLabel, "Mbps", 1200);

  const upload = await measureUpload();
  await animateBar(uploadBar, upload*5, uploadLabel, "Mbps", 1200);

  result.textContent = `Ping: ${ping} ms | Letöltés: ${download} Mbps | Feltöltés: ${upload} Mbps`;
}

document.getElementById("testBtn").addEventListener("click", runTest);
</script>

</body>
</html>
